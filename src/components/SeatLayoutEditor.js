import React, { useState, useCallback, useRef, useEffect } from 'react';\nimport { venueAPI, seatLayoutAPI } from '../services/api';\nimport '../styles/SeatLayoutEditor.css';\n\n// ì¢Œì„ íƒ€ì… ì •ì˜\nconst SEAT_TYPES = {\n  REGULAR: { color: '#3B82F6', name: 'ì¼ë°˜ì„', price: 50000 },\n  VIP: { color: '#F59E0B', name: 'VIPì„', price: 100000 },\n  PREMIUM: { color: '#8B5CF6', name: 'í”„ë¦¬ë¯¸ì—„ì„', price: 75000 },\n  WHEELCHAIR: { color: '#10B981', name: 'íœ ì²´ì–´ì„', price: 50000 },\n  BLOCKED: { color: '#6B7280', name: 'ë§‰íŒ ì¢Œì„', price: 0 }\n};\n\n// ì„¹ì…˜ ìƒ‰ìƒ íŒ”ë ˆíŠ¸\nconst SECTION_COLORS = [\n  '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57', \n  '#FF8A80', '#82B1FF', '#B39DDB', '#A5D6A7', '#FFCC80'\n];\n\n// ê°œì„ ëœ ì¢Œì„ ë°°ì¹˜ ì—ë””í„° (ê²©ì ëª¨ë“œ + ììœ  ë°°ì¹˜ ëª¨ë“œ í†µí•©)\nconst SeatLayoutEditor = ({ venueId, onClose }) => {\n  // ìƒíƒœ ê´€ë¦¬\n  const [editMode, setEditMode] = useState('grid'); // 'grid' ë˜ëŠ” 'free'\n  const [currentTool, setCurrentTool] = useState('add'); // 'add', 'select', 'delete'\n  const [selectedSeatType, setSelectedSeatType] = useState('REGULAR');\n  const [seats, setSeats] = useState([]);\n  const [selectedSeats, setSelectedSeats] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [showGrid, setShowGrid] = useState(true);\n  const [gridSize] = useState(40);\n  const [canvasSize] = useState({ width: 800, height: 600 });\n  const [stage, setStage] = useState({ x: 200, y: 50, width: 200, height: 60 });\n  \n  // ì„¹ì…˜ ê´€ë¦¬\n  const [sections, setSections] = useState([\n    { id: 1, name: '1êµ¬ì—­', color: '#FF6B6B', seatCount: 0 },\n    { id: 2, name: '2êµ¬ì—­', color: '#4ECDC4', seatCount: 0 },\n    { id: 3, name: '3êµ¬ì—­', color: '#45B7D1', seatCount: 0 }\n  ]);\n  const [selectedSection, setSelectedSection] = useState(1);\n  \n  // ë“œë˜ê·¸ ë° ìƒí˜¸ì‘ìš© ê´€ë ¨\n  const [draggedSeat, setDraggedSeat] = useState(null);\n  const [isDragSelecting, setIsDragSelecting] = useState(false);\n  const [dragSelectStart, setDragSelectStart] = useState({ x: 0, y: 0 });\n  const [dragSelectEnd, setDragSelectEnd] = useState({ x: 0, y: 0 });\n  const [dragSelectRect, setDragSelectRect] = useState(null);\n  \n  // ê³ ê¸‰ ê¸°ëŠ¥ë“¤\n  const [history, setHistory] = useState([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n  const [showTemplateModal, setShowTemplateModal] = useState(false);\n  const [templatePreviews, setTemplatePreviews] = useState([]);\n  const [validationErrors, setValidationErrors] = useState([]);\n  \n  const canvasRef = useRef(null);\n\n  // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      if (e.ctrlKey || e.metaKey) {\n        switch (e.key) {\n          case 'z':\n            e.preventDefault();\n            if (e.shiftKey) {\n              redo();\n            } else {\n              undo();\n            }\n            break;\n          case 'y':\n            e.preventDefault();\n            redo();\n            break;\n          case 'a':\n            e.preventDefault();\n            selectAllSeats();\n            break;\n          case 's':\n            e.preventDefault();\n            saveLayout();\n            break;\n          case 'd':\n            e.preventDefault();\n            deleteSelectedSeats();\n            break;\n        }\n      }\n      \n      // ë„êµ¬ ë‹¨ì¶•í‚¤\n      switch (e.key) {\n        case '1':\n          setCurrentTool('add');\n          break;\n        case '2':\n          setCurrentTool('select');\n          break;\n        case '3':\n          setCurrentTool('delete');\n          break;\n        case 'g':\n          setShowGrid(!showGrid);\n          break;\n        case 'Escape':\n          setSelectedSeats([]);\n          setCurrentTool('select');\n          break;\n        case 'Delete':\n        case 'Backspace':\n          if (selectedSeats.length > 0) {\n            deleteSelectedSeats();\n          }\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [showGrid, selectedSeats]);\n\n  // íˆìŠ¤í† ë¦¬ ê´€ë¦¬\n  const saveToHistory = useCallback(() => {\n    const newState = {\n      seats: JSON.parse(JSON.stringify(seats)),\n      sections: JSON.parse(JSON.stringify(sections)),\n      stage: JSON.parse(JSON.stringify(stage))\n    };\n    \n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push(newState);\n    \n    if (newHistory.length > 50) {\n      newHistory.shift();\n    } else {\n      setHistoryIndex(prevIndex => prevIndex + 1);\n    }\n    \n    setHistory(newHistory);\n  }, [seats, sections, stage, history, historyIndex]);\n\n  const undo = useCallback(() => {\n    if (historyIndex > 0) {\n      const newIndex = historyIndex - 1;\n      const state = history[newIndex];\n      setSeats(state.seats);\n      setSections(state.sections);\n      setStage(state.stage);\n      setHistoryIndex(newIndex);\n    }\n  }, [history, historyIndex]);\n\n  const redo = useCallback(() => {\n    if (historyIndex < history.length - 1) {\n      const newIndex = historyIndex + 1;\n      const state = history[newIndex];\n      setSeats(state.seats);\n      setSections(state.sections);\n      setStage(state.stage);\n      setHistoryIndex(newIndex);\n    }\n  }, [history, historyIndex]);\n\n  // ë°ì´í„° ë¡œë“œ\n  useEffect(() => {\n    if (venueId) {\n      loadSeatLayout();\n    }\n    loadTemplates();\n  }, [venueId]);\n\n  const loadSeatLayout = async () => {\n    try {\n      setLoading(true);\n      const response = await seatLayoutAPI.getVenueLayout(venueId);\n      \n      if (response.seats && response.seats.length > 0) {\n        const loadedSeats = response.seats.map(seat => ({\n          id: seat.id || `seat-${Date.now()}-${Math.random()}`,\n          x: seat.x || seat.xPosition || 0,\n          y: seat.y || seat.yPosition || 0,\n          type: seat.type || seat.seatType || 'REGULAR',\n          section: seat.section || seat.sectionId || 1,\n          label: seat.label || seat.seatLabel || '1',\n          price: seat.price || SEAT_TYPES[seat.type || 'REGULAR'].price,\n          isActive: seat.isActive !== undefined ? seat.isActive : true,\n          rotation: seat.rotation || 0\n        }));\n        setSeats(loadedSeats);\n        saveToHistory();\n      }\n      \n      if (response.sections && response.sections.length > 0) {\n        setSections(response.sections.map(section => ({\n          id: section.id || section.sectionId,\n          name: section.name || section.sectionName || `${section.id}êµ¬ì—­`,\n          color: section.color || section.sectionColor || SECTION_COLORS[(section.id - 1) % SECTION_COLORS.length],\n          seatCount: section.seatCount || 0\n        })));\n      }\n      \n      if (response.stage) {\n        setStage(response.stage);\n      }\n      \n      if (response.editMode) {\n        setEditMode(response.editMode);\n      }\n    } catch (error) {\n      console.error('ì¢Œì„ ë°°ì¹˜ ë¡œë“œ ì‹¤íŒ¨:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadTemplates = async () => {\n    try {\n      const templates = await seatLayoutAPI.getAvailableTemplates();\n      const previews = await Promise.all(\n        templates.map(async (template) => {\n          try {\n            const preview = await seatLayoutAPI.getTemplatePreview(template.name, { editMode });\n            return { ...template, preview };\n          } catch (error) {\n            console.warn(`í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° ë¡œë“œ ì‹¤íŒ¨: ${template.name}`, error);\n            return template;\n          }\n        })\n      );\n      setTemplatePreviews(previews);\n    } catch (error) {\n      console.error('í…œí”Œë¦¿ ë¡œë“œ ì‹¤íŒ¨:', error);\n    }\n  };\n\n  // ì¢Œì„ ì»´í¬ë„ŒíŠ¸\n  const SeatComponent = ({ seat, isSelected, onMouseDown, onClick, onContextMenu }) => {\n    const seatType = SEAT_TYPES[seat.type] || SEAT_TYPES.REGULAR;\n    const section = sections.find(s => s.id === seat.section) || sections[0];\n    \n    return (\n      <div\n        className={`seat-component ${isSelected ? 'selected' : ''} ${currentTool}`}\n        style={{\n          position: 'absolute',\n          left: editMode === 'grid' ? seat.x * gridSize : seat.x,\n          top: editMode === 'grid' ? seat.y * gridSize : seat.y,\n          width: editMode === 'grid' ? gridSize - 4 : 40,\n          height: editMode === 'grid' ? gridSize - 4 : 40,\n          backgroundColor: seatType.color,\n          border: `3px solid ${isSelected ? '#FF6600' : (section?.color || '#FFFFFF')}`,\n          borderRadius: '8px',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          color: 'white',\n          fontSize: '10px',\n          fontWeight: 'bold',\n          cursor: currentTool === 'add' ? 'crosshair' : \n                  currentTool === 'select' ? 'pointer' :\n                  currentTool === 'delete' ? 'not-allowed' : 'move',\n          userSelect: 'none',\n          boxShadow: isSelected ? '0 0 0 3px rgba(255, 102, 0, 0.3)' : '0 2px 4px rgba(0,0,0,0.1)',\n          transition: 'all 0.2s ease',\n          zIndex: isSelected ? 10 : 1,\n          transform: `scale(${isSelected ? 1.1 : 1}) rotate(${seat.rotation || 0}deg)`\n        }}\n        onMouseDown={onMouseDown}\n        onClick={onClick}\n        onContextMenu={onContextMenu}\n        title={`${seat.label} (${seatType.name})`}\n      >\n        {seat.label}\n      </div>\n    );\n  };\n\n  // ë¬´ëŒ€ ì»´í¬ë„ŒíŠ¸\n  const StageComponent = () => (\n    <div\n      className=\"stage-component\"\n      style={{\n        position: 'absolute',\n        left: stage.x,\n        top: stage.y,\n        width: stage.width,\n        height: stage.height,\n        backgroundColor: '#1F2937',\n        border: '2px solid #374151',\n        borderRadius: '12px',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        color: 'white',\n        fontSize: '16px',\n        fontWeight: 'bold',\n        zIndex: 5,\n        boxShadow: '0 4px 8px rgba(0,0,0,0.2)',\n        transform: `rotate(${stage.rotation || 0}deg)`\n      }}\n    >\n      STAGE\n    </div>\n  );\n\n  // ê²©ì ì˜¤ë²„ë ˆì´\n  const GridOverlay = () => {\n    if (!showGrid) return null;\n    \n    const cols = Math.floor(canvasSize.width / gridSize);\n    const rows = Math.floor(canvasSize.height / gridSize);\n    \n    return (\n      <svg\n        className=\"grid-overlay\"\n        style={{\n          position: 'absolute',\n          top: 0,\n          left: 0,\n          width: '100%',\n          height: '100%',\n          pointerEvents: 'none',\n          zIndex: 0\n        }}\n      >\n        {Array.from({ length: cols + 1 }, (_, i) => (\n          <line\n            key={`v-${i}`}\n            x1={i * gridSize}\n            y1={0}\n            x2={i * gridSize}\n            y2={canvasSize.height}\n            stroke=\"#E5E7EB\"\n            strokeWidth=\"1\"\n            opacity=\"0.5\"\n          />\n        ))}\n        {Array.from({ length: rows + 1 }, (_, i) => (\n          <line\n            key={`h-${i}`}\n            x1={0}\n            y1={i * gridSize}\n            x2={canvasSize.width}\n            y2={i * gridSize}\n            stroke=\"#E5E7EB\"\n            strokeWidth=\"1\"\n            opacity=\"0.5\"\n          />\n        ))}\n      </svg>\n    );\n  };\n\n  // ë“œë˜ê·¸ ì„ íƒ ì˜ì—­\n  const DragSelectOverlay = () => {\n    if (!isDragSelecting || !dragSelectRect) return null;\n    \n    return (\n      <div\n        className=\"drag-select-overlay\"\n        style={{\n          position: 'absolute',\n          left: dragSelectRect.x,\n          top: dragSelectRect.y,\n          width: dragSelectRect.width,\n          height: dragSelectRect.height,\n          border: '2px dashed #007bff',\n          backgroundColor: 'rgba(0, 123, 255, 0.1)',\n          pointerEvents: 'none',\n          zIndex: 20\n        }}\n      />\n    );\n  };\n\n  // ë§ˆìš°ìŠ¤ ìœ„ì¹˜ ê³„ì‚°\n  const getMousePosition = useCallback((e) => {\n    if (!canvasRef.current) return { x: 0, y: 0 };\n    \n    const rect = canvasRef.current.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    \n    if (editMode === 'grid') {\n      return {\n        x: Math.floor(x / gridSize),\n        y: Math.floor(y / gridSize)\n      };\n    }\n    \n    return { x, y };\n  }, [editMode, gridSize]);\n\n  // ì¢Œì„ ì¶”ê°€\n  const addSeat = useCallback((e) => {\n    if (currentTool !== 'add') return;\n    \n    const pos = getMousePosition(e);\n    const currentSection = sections.find(s => s.id === selectedSection);\n    \n    // ê²½ê³„ ì²´í¬\n    if (editMode === 'grid') {\n      if (pos.x < 0 || pos.x >= Math.floor(canvasSize.width / gridSize) || \n          pos.y < 0 || pos.y >= Math.floor(canvasSize.height / gridSize)) {\n        return;\n      }\n      \n      // ì¤‘ë³µ ì²´í¬\n      const existingSeat = seats.find(seat => seat.x === pos.x && seat.y === pos.y);\n      if (existingSeat) return;\n    } else {\n      if (pos.x < 20 || pos.x > canvasSize.width - 60 || pos.y < 20 || pos.y > canvasSize.height - 60) {\n        return;\n      }\n    }\n    \n    const newSeat = {\n      id: `seat-${Date.now()}-${Math.random()}`,\n      x: pos.x,\n      y: pos.y,\n      type: selectedSeatType,\n      section: selectedSection,\n      label: `${currentSection?.name || '1êµ¬ì—­'}-${seats.length + 1}`,\n      price: SEAT_TYPES[selectedSeatType].price,\n      isActive: true,\n      rotation: 0\n    };\n    \n    setSeats(prev => [...prev, newSeat]);\n    saveToHistory();\n  }, [currentTool, getMousePosition, editMode, gridSize, canvasSize, seats, selectedSeatType, selectedSection, sections, saveToHistory]);\n\n  // ëª¨ë“  ì¢Œì„ ì„ íƒ\n  const selectAllSeats = useCallback(() => {\n    setSelectedSeats(seats.map(seat => seat.id));\n  }, [seats]);\n\n  // ì„ íƒëœ ì¢Œì„ ì‚­ì œ\n  const deleteSelectedSeats = useCallback(() => {\n    if (selectedSeats.length === 0) return;\n    \n    if (window.confirm(`ì„ íƒëœ ${selectedSeats.length}ê°œì˜ ì¢Œì„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {\n      setSeats(prev => prev.filter(seat => !selectedSeats.includes(seat.id)));\n      setSelectedSeats([]);\n      saveToHistory();\n    }\n  }, [selectedSeats, saveToHistory]);\n\n  // ì¢Œì„ ì„ íƒ/ì‚­ì œ\n  const handleSeatClick = useCallback((seat, e) => {\n    e.stopPropagation();\n    \n    if (currentTool === 'select') {\n      setSelectedSeats(prev => {\n        if (prev.includes(seat.id)) {\n          return prev.filter(id => id !== seat.id);\n        } else {\n          return e.ctrlKey || e.metaKey ? [...prev, seat.id] : [seat.id];\n        }\n      });\n    } else if (currentTool === 'delete') {\n      setSeats(prev => prev.filter(s => s.id !== seat.id));\n      setSelectedSeats(prev => prev.filter(id => id !== seat.id));\n      saveToHistory();\n    }\n  }, [currentTool, saveToHistory]);\n\n  // ìš°í´ë¦­ìœ¼ë¡œ ì¢Œì„ ì‚­ì œ\n  const handleSeatContextMenu = useCallback((seat, e) => {\n    e.preventDefault();\n    setSeats(prev => prev.filter(s => s.id !== seat.id));\n    setSelectedSeats(prev => prev.filter(id => id !== seat.id));\n    saveToHistory();\n  }, [saveToHistory]);\n\n  // ì¢Œì„ ë“œë˜ê·¸\n  const handleSeatMouseDown = useCallback((seat, e) => {\n    if (editMode === 'free' && currentTool === 'select') {\n      e.stopPropagation();\n      const pos = getMousePosition(e);\n      setDraggedSeat({\n        ...seat,\n        offsetX: pos.x - seat.x,\n        offsetY: pos.y - seat.y\n      });\n    } else {\n      handleSeatClick(seat, e);\n    }\n  }, [editMode, currentTool, getMousePosition, handleSeatClick]);\n\n  // ìº”ë²„ìŠ¤ ë§ˆìš°ìŠ¤ ë‹¤ìš´ (ë“œë˜ê·¸ ì„ íƒ ì‹œì‘)\n  const handleCanvasMouseDown = useCallback((e) => {\n    if (currentTool === 'select' && editMode === 'free') {\n      const pos = getMousePosition(e);\n      setIsDragSelecting(true);\n      setDragSelectStart(pos);\n      setDragSelectEnd(pos);\n      setDragSelectRect({ x: pos.x, y: pos.y, width: 0, height: 0 });\n    }\n  }, [currentTool, editMode, getMousePosition]);\n\n  // ë§ˆìš°ìŠ¤ ì´ë™ ì²˜ë¦¬\n  const handleMouseMove = useCallback((e) => {\n    if (isDragSelecting) {\n      const pos = getMousePosition(e);\n      setDragSelectEnd(pos);\n      \n      const minX = Math.min(dragSelectStart.x, pos.x);\n      const minY = Math.min(dragSelectStart.y, pos.y);\n      const maxX = Math.max(dragSelectStart.x, pos.x);\n      const maxY = Math.max(dragSelectStart.y, pos.y);\n      \n      setDragSelectRect({\n        x: minX,\n        y: minY,\n        width: maxX - minX,\n        height: maxY - minY\n      });\n    } else if (draggedSeat && editMode === 'free') {\n      const pos = getMousePosition(e);\n      const newX = Math.max(0, Math.min(pos.x - draggedSeat.offsetX, canvasSize.width - 40));\n      const newY = Math.max(0, Math.min(pos.y - draggedSeat.offsetY, canvasSize.height - 40));\n      \n      setSeats(prev => prev.map(seat => \n        seat.id === draggedSeat.id \n          ? { ...seat, x: newX, y: newY }\n          : seat\n      ));\n    }\n  }, [isDragSelecting, draggedSeat, editMode, getMousePosition, dragSelectStart, canvasSize]);\n\n  // ë§ˆìš°ìŠ¤ ì—… ì²˜ë¦¬\n  const handleMouseUp = useCallback(() => {\n    if (isDragSelecting && dragSelectRect) {\n      const selectedSeatIds = seats\n        .filter(seat => {\n          const seatX = editMode === 'grid' ? seat.x * gridSize : seat.x;\n          const seatY = editMode === 'grid' ? seat.y * gridSize : seat.y;\n          \n          return (\n            seatX >= dragSelectRect.x &&\n            seatX <= dragSelectRect.x + dragSelectRect.width &&\n            seatY >= dragSelectRect.y &&\n            seatY <= dragSelectRect.y + dragSelectRect.height\n          );\n        })\n        .map(seat => seat.id);\n      \n      setSelectedSeats(prev => [...new Set([...prev, ...selectedSeatIds])]);\n    }\n    \n    if (draggedSeat) {\n      saveToHistory();\n    }\n    \n    setDraggedSeat(null);\n    setIsDragSelecting(false);\n    setDragSelectRect(null);\n  }, [isDragSelecting, dragSelectRect, seats, editMode, gridSize, draggedSeat, saveToHistory]);\n\n  // ì „ì—­ ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ\n  useEffect(() => {\n    if (draggedSeat || isDragSelecting) {\n      document.addEventListener('mousemove', handleMouseMove);\n      document.addEventListener('mouseup', handleMouseUp);\n      \n      return () => {\n        document.removeEventListener('mousemove', handleMouseMove);\n        document.removeEventListener('mouseup', handleMouseUp);\n      };\n    }\n  }, [draggedSeat, isDragSelecting, handleMouseMove, handleMouseUp]);\n\n  // í…œí”Œë¦¿ ì ìš©\n  const applyTemplate = useCallback(async (templateName, config = {}) => {\n    try {\n      setLoading(true);\n      const fullConfig = { ...config, editMode };\n      const response = await seatLayoutAPI.applyTemplate(venueId, templateName, fullConfig);\n      \n      if (response.seats) {\n        const appliedSeats = response.seats.map(seat => ({\n          id: seat.id || `seat-${Date.now()}-${Math.random()}`,\n          x: seat.x || seat.xPosition || 0,\n          y: seat.y || seat.yPosition || 0,\n          type: seat.type || seat.seatType || 'REGULAR',\n          section: seat.section || seat.sectionId || 1,\n          label: seat.label || seat.seatLabel || '1',\n          price: seat.price || SEAT_TYPES[seat.type || 'REGULAR'].price,\n          isActive: seat.isActive !== undefined ? seat.isActive : true,\n          rotation: seat.rotation || 0\n        }));\n        setSeats(appliedSeats);\n      }\n      \n      if (response.sections) {\n        setSections(response.sections);\n      }\n      \n      setSelectedSeats([]);\n      saveToHistory();\n      setShowTemplateModal(false);\n    } catch (error) {\n      console.error('í…œí”Œë¦¿ ì ìš© ì‹¤íŒ¨:', error);\n      alert('í…œí”Œë¦¿ ì ìš© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setLoading(false);\n    }\n  }, [venueId, editMode, saveToHistory]);\n\n  // ì„ íƒëœ ì¢Œì„ ì¼ê´„ í¸ì§‘\n  const editSelectedSeats = useCallback((changes) => {\n    setSeats(prev => prev.map(seat => {\n      if (selectedSeats.includes(seat.id)) {\n        const updatedSeat = { ...seat, ...changes };\n        if (changes.type) {\n          updatedSeat.price = SEAT_TYPES[changes.type].price;\n        }\n        return updatedSeat;\n      }\n      return seat;\n    }));\n    saveToHistory();\n  }, [selectedSeats, saveToHistory]);\n\n  // ì¢Œì„ ë°°ì¹˜ ìœ íš¨ì„± ê²€ì‚¬\n  const validateLayout = useCallback(async () => {\n    try {\n      const layoutData = {\n        seats: seats.map(seat => ({\n          id: seat.originalId || null,\n          x: seat.x,\n          y: seat.y,\n          type: seat.type,\n          section: seat.section,\n          label: seat.label,\n          price: seat.price,\n          isActive: seat.isActive,\n          rotation: seat.rotation\n        })),\n        sections: sections,\n        stage: stage,\n        canvas: { width: canvasSize.width, height: canvasSize.height, gridSize: gridSize },\n        editMode: editMode\n      };\n\n      const validation = await seatLayoutAPI.validateSeatLayout(venueId, layoutData);\n      setValidationErrors(validation.issues || []);\n      \n      if (validation.valid) {\n        alert('âœ… ì¢Œì„ ë°°ì¹˜ê°€ ìœ íš¨í•©ë‹ˆë‹¤!');\n      } else {\n        alert('âŒ ì¢Œì„ ë°°ì¹˜ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ì˜¤ë¥˜ ëª©ë¡ì„ í™•ì¸í•˜ì„¸ìš”.');\n      }\n    } catch (error) {\n      console.error('ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨:', error);\n      setValidationErrors(['ìœ íš¨ì„± ê²€ì‚¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.']);\n    }\n  }, [venueId, seats, sections, stage, canvasSize, gridSize, editMode]);\n\n  // ì „ì²´ ì‚­ì œ\n  const clearAllSeats = useCallback(() => {\n    if (window.confirm('ëª¨ë“  ì¢Œì„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {\n      setSeats([]);\n      setSelectedSeats([]);\n      saveToHistory();\n    }\n  }, [saveToHistory]);\n\n  // ì €ì¥\n  const saveLayout = useCallback(async () => {\n    try {\n      setLoading(true);\n      const layoutData = {\n        seats: seats.map(seat => ({\n          id: seat.originalId || null,\n          x: seat.x,\n          y: seat.y,\n          type: seat.type,\n          section: seat.section,\n          label: seat.label,\n          price: seat.price,\n          isActive: seat.isActive,\n          rotation: seat.rotation\n        })),\n        sections: sections,\n        stage: stage,\n        canvas: { width: canvasSize.width, height: canvasSize.height, gridSize: gridSize },\n        editMode: editMode\n      };\n\n      await seatLayoutAPI.saveVenueLayout(venueId, layoutData);\n      alert('âœ… ì¢Œì„ ë°°ì¹˜ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');\n    } catch (error) {\n      console.error('ì €ì¥ ì‹¤íŒ¨:', error);\n      alert('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setLoading(false);\n    }\n  }, [venueId, seats, sections, stage, canvasSize, gridSize, editMode]);\n\n  // í†µê³„ ê³„ì‚°\n  const statistics = {\n    totalSeats: seats.length,\n    totalRevenue: seats.reduce((sum, seat) => sum + seat.price, 0),\n    selectedSeats: selectedSeats.length,\n    seatTypes: Object.keys(SEAT_TYPES).reduce((acc, type) => {\n      acc[type] = seats.filter(seat => seat.type === type).length;\n      return acc;\n    }, {})\n  };\n\n  // í…œí”Œë¦¿ ëª¨ë‹¬\n  const TemplateModal = () => {\n    if (!showTemplateModal) return null;\n    \n    return (\n      <div className=\"modal-overlay\" onClick={() => setShowTemplateModal(false)}>\n        <div className=\"template-modal\" onClick={(e) => e.stopPropagation()}>\n          <div className=\"modal-header\">\n            <h3>ğŸ›ï¸ í…œí”Œë¦¿ ì„ íƒ</h3>\n            <button onClick={() => setShowTemplateModal(false)} className=\"close-button\">Ã—</button>\n          </div>\n          <div className=\"template-grid\">\n            {templatePreviews.map(template => (\n              <div key={template.name} className=\"template-card\">\n                <div className=\"template-preview\">\n                  <div className=\"template-image\">\n                    {/* í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ ë˜ëŠ” ê°„ë‹¨í•œ ë„ì‹ */}\n                    <div className=\"template-diagram\">\n                      {Array.from({ length: Math.min(template.rows || 8, 6) }, (_, row) => (\n                        <div key={row} className=\"template-row\">\n                          {Array.from({ length: Math.min(template.cols || 6, 8) }, (_, col) => (\n                            <div key={col} className=\"template-seat\" />\n                          ))}\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                  <div className=\"template-info\">\n                    <h4>{template.displayName}</h4>\n                    <p>{template.description}</p>\n                    <div className=\"template-stats\">\n                      <span>ğŸ“ {template.rows}í–‰ Ã— {template.cols}ì—´</span>\n                      <span>ğŸª‘ ì•½ {template.estimatedSeats}ì„</span>\n                      {template.preview && (\n                        <span>ğŸ’° {template.preview.estimatedRevenue?.toLocaleString()}ì›</span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n                <button\n                  onClick={() => applyTemplate(template.name)}\n                  className=\"btn btn-primary btn-block\"\n                  disabled={loading}\n                >\n                  {template.isPopular && 'â­ '}{loading ? 'ì ìš© ì¤‘...' : 'ì ìš©í•˜ê¸°'}\n                </button>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  if (loading && seats.length === 0) {\n    return (\n      <div className=\"seat-layout-editor loading\">\n        <div className=\"loading-container\">\n          <div className=\"loading-spinner\"></div>\n          <span>ì¢Œì„ ë°°ì¹˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"seat-layout-editor\">\n      {/* í—¤ë” */}\n      <div className=\"header\">\n        <div className=\"header-left\">\n          <h2>ğŸ­ ê°œì„ ëœ ì¢Œì„ ë°°ì¹˜ ì—ë””í„°</h2>\n          <p className=\"stats\">\n            ì´ {statistics.totalSeats}ê°œ ì¢Œì„ | ì„ íƒë¨: {statistics.selectedSeats}ê°œ | \n            ì˜ˆìƒ ìˆ˜ìµ: {statistics.totalRevenue.toLocaleString()}ì›\n            {validationErrors.length > 0 && (\n              <span className=\"validation-errors\"> | âš ï¸ {validationErrors.length}ê°œ ì˜¤ë¥˜</span>\n            )}\n          </p>\n        </div>\n        \n        <div className=\"header-center\">\n          {/* ëª¨ë“œ ì „í™˜ */}\n          <div className=\"mode-toggle\">\n            <button\n              onClick={() => setEditMode('grid')}\n              className={`mode-btn ${editMode === 'grid' ? 'active' : ''}`}\n            >\n              ğŸ“ ê²©ì ëª¨ë“œ\n            </button>\n            <button\n              onClick={() => setEditMode('free')}\n              className={`mode-btn ${editMode === 'free' ? 'active' : ''}`}\n            >\n              ğŸ–±ï¸ ììœ  ë°°ì¹˜\n            </button>\n          </div>\n        </div>\n        \n        <div className=\"header-right\">\n          <div className=\"action-buttons\">\n            <button\n              onClick={() => setShowTemplateModal(true)}\n              className=\"btn btn-info\"\n              title=\"í…œí”Œë¦¿ ì ìš©\"\n            >\n              ğŸ›ï¸ í…œí”Œë¦¿\n            </button>\n            \n            <button\n              onClick={validateLayout}\n              className=\"btn btn-warning\"\n              title=\"ìœ íš¨ì„± ê²€ì‚¬\"\n            >\n              âœ… ê²€ì‚¬\n            </button>\n            \n            <button\n              onClick={undo}\n              disabled={historyIndex <= 0}\n              className=\"btn btn-secondary\"\n              title=\"ë˜ëŒë¦¬ê¸° (Ctrl+Z)\"\n            >\n              â†¶ ë˜ëŒë¦¬ê¸°\n            </button>\n            \n            <button\n              onClick={redo}\n              disabled={historyIndex >= history.length - 1}\n              className=\"btn btn-secondary\"\n              title=\"ë‹¤ì‹œí•˜ê¸° (Ctrl+Y)\"\n            >\n              â†· ë‹¤ì‹œí•˜ê¸°\n            </button>\n            \n            <button\n              onClick={saveLayout}\n              disabled={loading}\n              className={`btn btn-primary ${loading ? 'loading' : ''}`}\n              title=\"ì €ì¥ (Ctrl+S)\"\n            >\n              {loading ? 'ğŸ’¾ ì €ì¥ ì¤‘...' : 'ğŸ’¾ ì €ì¥'}\n            </button>\n            \n            <button onClick={onClose} className=\"btn btn-secondary\">\n              âœ–ï¸ ë‹«ê¸°\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ë„ì›€ë§ */}\n      <div className=\"keyboard-shortcuts\">\n        <small>\n          <strong>ë‹¨ì¶•í‚¤:</strong> \n          1-3 (ë„êµ¬ ë³€ê²½) | G (ê²©ì) | Ctrl+A (ì „ì²´ì„ íƒ) | Ctrl+S (ì €ì¥) | Ctrl+Z/Y (ë˜ëŒë¦¬ê¸°/ë‹¤ì‹œí•˜ê¸°) | Del (ì‚­ì œ)\n        </small>\n      </div>\n\n      {/* ìœ íš¨ì„± ê²€ì‚¬ ì˜¤ë¥˜ */}\n      {validationErrors.length > 0 && (\n        <div className=\"validation-panel\">\n          <h4>âš ï¸ ìœ íš¨ì„± ê²€ì‚¬ ì˜¤ë¥˜</h4>\n          <ul>\n            {validationErrors.map((error, index) => (\n              <li key={index}>{error}</li>\n            ))}\n          </ul>\n        </div>\n      )}\n\n      {/* ë©”ì¸ ì½˜í…ì¸  */}\n      <div className=\"main-content\">\n        {/* ì‚¬ì´ë“œë°” */}\n        <div className=\"sidebar\">\n          {/* ë„êµ¬ ì„ íƒ */}\n          <div className=\"section\">\n            <h3>ğŸ”§ ë„êµ¬</h3>\n            <div className=\"tool-buttons\">\n              {[\n                { key: 'add', label: 'â• ì¢Œì„ ì¶”ê°€ (1)', color: '#28a745' },\n                { key: 'select', label: 'ğŸ¯ ì¢Œì„ ì„ íƒ (2)', color: '#ffc107' },\n                { key: 'delete', label: 'ğŸ—‘ï¸ ì¢Œì„ ì‚­ì œ (3)', color: '#dc3545' }\n              ].map(tool => (\n                <button\n                  key={tool.key}\n                  onClick={() => setCurrentTool(tool.key)}\n                  className={`tool-btn ${currentTool === tool.key ? 'active' : ''}`}\n                  style={{ '--tool-color': tool.color }}\n                >\n                  {tool.label}\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* ì¢Œì„ íƒ€ì… */}\n          <div className=\"section\">\n            <h3>ğŸª‘ ì¢Œì„ íƒ€ì…</h3>\n            <div className=\"seat-types\">\n              {Object.entries(SEAT_TYPES).map(([type, info]) => (\n                <button\n                  key={type}\n                  onClick={() => setSelectedSeatType(type)}\n                  className={`seat-type-btn ${selectedSeatType === type ? 'active' : ''}`}\n                  style={{ '--seat-color': info.color }}\n                >\n                  <div className=\"seat-type-color\" style={{ backgroundColor: info.color }} />\n                  <div className=\"seat-type-info\">\n                    <div className=\"seat-type-name\">{info.name}</div>\n                    <div className=\"seat-type-price\">{info.price.toLocaleString()}ì›</div>\n                    <div className=\"seat-type-count\">({statistics.seatTypes[type] || 0}ê°œ)</div>\n                  </div>\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* ì„ íƒëœ ì¢Œì„ í¸ì§‘ */}\n          {selectedSeats.length > 0 && (\n            <div className=\"section edit-section\">\n              <h3>âœï¸ ì„ íƒëœ ì¢Œì„ í¸ì§‘ ({selectedSeats.length}ê°œ)</h3>\n              <div className=\"edit-controls\">\n                <select\n                  onChange={(e) => e.target.value && editSelectedSeats({ type: e.target.value })}\n                  className=\"select-control\"\n                  defaultValue=\"\"\n                >\n                  <option value=\"\">ì¢Œì„ íƒ€ì… ë³€ê²½</option>\n                  {Object.entries(SEAT_TYPES).map(([type, info]) => (\n                    <option key={type} value={type}>{info.name}</option>\n                  ))}\n                </select>\n                \n                <select\n                  onChange={(e) => e.target.value && editSelectedSeats({ section: parseInt(e.target.value) })}\n                  className=\"select-control\"\n                  defaultValue=\"\"\n                >\n                  <option value=\"\">ì„¹ì…˜ ì´ë™</option>\n                  {sections.map(section => (\n                    <option key={section.id} value={section.id}>{section.name}</option>\n                  ))}\n                </select>\n                \n                <button\n                  onClick={() => editSelectedSeats({ rotation: 0 })}\n                  className=\"btn btn-info btn-sm\"\n                >\n                  ğŸ”„ íšŒì „ ì´ˆê¸°í™”\n                </button>\n                \n                <button\n                  onClick={deleteSelectedSeats}\n                  className=\"btn btn-danger btn-sm\"\n                >\n                  ì„ íƒëœ ì¢Œì„ ì‚­ì œ\n                </button>\n              </div>\n            </div>\n          )}\n\n          {/* ê´€ë¦¬ */}\n          <div className=\"section\">\n            <h3>ğŸ”§ ê´€ë¦¬</h3>\n            <div className=\"management-controls\">\n              <button onClick={selectAllSeats} className=\"btn btn-info btn-sm\">\n                ğŸ¯ ì „ì²´ ì„ íƒ (Ctrl+A)\n              </button>\n              <button onClick={clearAllSeats} className=\"btn btn-danger btn-sm\">\n                ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ\n              </button>\n            </div>\n          </div>\n\n          {/* ì˜µì…˜ */}\n          <div className=\"section\">\n            <h3>âš™ï¸ ì˜µì…˜</h3>\n            <label className=\"checkbox-label\">\n              <input\n                type=\"checkbox\"\n                checked={showGrid}\n                onChange={(e) => setShowGrid(e.target.checked)}\n              />\n              <span>ê²©ì í‘œì‹œ (G)</span>\n            </label>\n          </div>\n        </div>\n\n        {/* ìº”ë²„ìŠ¤ ì˜ì—­ */}\n        <div className=\"canvas-area\">\n          <div\n            ref={canvasRef}\n            className={`canvas ${editMode}-mode ${currentTool}-tool`}\n            style={{\n              width: canvasSize.width,\n              height: canvasSize.height\n            }}\n            onClick={addSeat}\n            onMouseDown={handleCanvasMouseDown}\n          >\n            {/* ê²©ì */}\n            {editMode === 'grid' && <GridOverlay />}\n            \n            {/* ë“œë˜ê·¸ ì„ íƒ ì˜ì—­ */}\n            <DragSelectOverlay />\n            \n            {/* ë¬´ëŒ€ */}\n            <StageComponent />\n            \n            {/* ì¢Œì„ë“¤ */}\n            {seats.map(seat => (\n              <SeatComponent\n                key={seat.id}\n                seat={seat}\n                isSelected={selectedSeats.includes(seat.id)}\n                onMouseDown={(e) => handleSeatMouseDown(seat, e)}\n                onClick={(e) => handleSeatClick(seat, e)}\n                onContextMenu={(e) => handleSeatContextMenu(seat, e)}\n              />\n            ))}\n          </div>\n          \n          {/* ë„ì›€ë§ */}\n          <div className=\"help-text\">\n            <strong>\n              {editMode === 'grid' ? 'ğŸ“ ê²©ì ëª¨ë“œ' : 'ğŸ–±ï¸ ììœ  ë°°ì¹˜ ëª¨ë“œ'} | \n              {currentTool === 'add' && ' ìº”ë²„ìŠ¤ë¥¼ í´ë¦­í•˜ì—¬ ì¢Œì„ì„ ì¶”ê°€í•˜ì„¸ìš”.'}\n              {currentTool === 'select' && ' ì¢Œì„ì„ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”. Ctrl+í´ë¦­ìœ¼ë¡œ ë‹¤ì¤‘ ì„ íƒ, ë“œë˜ê·¸ë¡œ ì˜ì—­ ì„ íƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.'}\n              {currentTool === 'delete' && ' ì¢Œì„ì„ í´ë¦­í•˜ê±°ë‚˜ ìš°í´ë¦­í•˜ì—¬ ì‚­ì œí•˜ì„¸ìš”.'}\n            </strong>\n          </div>\n        </div>\n      </div>\n\n      {/* í…œí”Œë¦¿ ëª¨ë‹¬ */}\n      <TemplateModal />\n    </div>\n  );\n};\n\nexport default SeatLayoutEditor;"